# TCP handshake

- TCP Handshake

  - TCP(전송제어프로토콜) / IP(인터넷 프로토콜)

  - ACK : acknowledgment

  - SYN : syschronize sequence number

  - **3-way Handshake**

    연결을 시작하는 경우 사용하는 통신 방법

    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f9bc68ed-102a-486a-b1a0-b9dd4f895469/Untitled.png)

    서버와 클라이언트가 상호 연결되어, 데이터 전송할 준비가 되었는지를 3번의 통신으로 확인 하는 것.

    1. 클라이언트 → 서버 ) 접속을 요청하는 의미에서 패킷에 SYN(ISN)을 담아 보낸다.
    2. 서버 → 클라이언트 ) 방금 보낸 패킷이 잘 도착했고(ACK), 요청을 수락한다는 의미(SYN)로 패킷을 보낸다.
    3. 클라이언트 → 서버 ) 서버가 통신을 허락했음을 확인하고, 해당 내용을 확인했다는 의미(ACK) 로 패킷을 서버로 다시 보낸다.

  - **4-way Handshake**

    연결, 접속을 종료하고 끊을 때 사용하는 통신 방법

    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d4adbf40-2238-4986-a72f-11aa9ffb5b43/Untitled.png)

    1. 클라이언트 → 서버 ) 연결을 종료하고자 한다는 것을 알린다(FIN)
    2. 서버 → 클라이언트 ) 알겠다고 응답한다(ACK)
       1. 이후 서버에서는 일정 시간 타임아웃을 두고 혹여 전송되지 않은 데이터를 마저 보낼 시간을 둔다.
    3. 서버 → 클라이언트 ) 더 이상 전달할 데이터가 없으니, 서버도 통신을 끊겠다고 한다(FIN)
    4. 클라이언트 → 서버 ) 알겠다고 한다(ACK)
       1. 이 이후에도 바로 소켓을 지워버리는 것이 아니라, 남은 데이터가 있거나 바로 재연결 될 가능성이 있기때문에 삭제하지 않고 조금 시간을 둔다.
       2. 일정 시간 후에 패킷이 더 이상 올 가능성이 없으면 소켓을 제거한다.

  - 랜덤한 SYN값을 보내는 이유?

    - ISN이 항상 같은 값(0과 같은) 으로 시작한다면 악의적으로 패킷을 훔칠 수 있고, 그것이 연결의 시작이라는걸 알수 있어서 위험
    - 접속할 때 포트번호가 유한하고, 재사용 된다. 그래서 이전에 사용한 포트쌍이 존재하는데, 난수가 아닌 순차적인 번호가 전송된다면, 이전 연결에서 오는 패킷으로 인식할 수 있다.



------

[ 참고 사항 ]

