# 캐시의 지역성

- 캐시의 지역성 원리
  - 캐시 메모리는 속도가 빠른 장치와 느린 장치간의 속도차에 따른 병목 현상을 줄이기 위한 범용 메모리이다.
  - 이러한 역할을 수행하기 위해서는 CPU 가 어떤 데이터를 원할 것인가를 어느 정도 예측할 수 있어야 한다.
  - 캐시의 성능은 작은 용량의 캐시 메모리에 CPU 가 이후에 참조할, 쓸모 있는 정보가 어느 정도 들어있느냐에 따라 좌우되기 때문이다.
  - 이 때 `적중율(Hit rate)`을 극대화 시키기 위해 데이터 `지역성(Locality)의 원리`를 사용한다. 지역성의 전제조건으로 프로그램은 모든 코드나 데이터를 균등하게 Access 하지 않는다는 특성을 기본으로 한다.
  - 즉, `Locality`란 기억 장치 내의 정보를 균일하게 Access 하는 것이 아닌 어느 한 순간에 특정 부분을 집중적으로 참조하는 특성인 것이다.
  - 이 데이터 지역성은 대표적으로 시간 지역성(Temporal Locality)과 공간 지역성(Spatial Locality)으로 나뉜다.
    - 시간 지역성 : 최근에 참조된 주소의 내용은 곧 다음에 다시 참조되는 특성.
    - 공간 지역성 : 대부분의 실제 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성
- Caching line
  - 캐시(cache)는 프로세서 가까이에 위치하면서 빈번하게 사용되는 데이터를 놔두는 장소이다.
  - 캐시에 목적 데이터가 저장되어 있다면 `바로 접근`하여 출력할 수 있어야 캐시가 의미 있어진다는 것이다.
  - 그렇기 때문에 캐시에 데이터를 저장할 때 특정 자료구조를 사용하여 `묶음`으로 저장하게 되는데 이를 **`캐싱 라인`** 이라고 한다.
  - 프로세스는 다양한 주소에 있는 데이터를 사용하므로 빈번하게 사용하는 데이터의 주소 또한 흩어져 있다. 따라서 캐시에 저장하는 데이터에는 데이터의 메모리 주소 등을 기록해 둔 태그를 달아놓을 필요가 있다. 이러한 태그들의 묶음을 캐싱 라인이라고 하고 메모리로부터 가져올 때도 캐싱 라인을 기준으로 가져온다. 종류로는 대표적으로 세 가지 방식이 존재한다.
    1. Direct Map
       1. 물리 메모리와 캐시메모리를 다이렉트로 연결
       2. 물리 메모리의 1번~10번까지는 캐시의 1번에 넣는식
       3. 자주 쓰는것도, 한번도 안쓰이는 것도 동일한 크기의 캐시에 저장됨, 비효율
    2. Fully Associative
       1. 빈 캐시 메모리에 아무거나 넣는 문제
       2. 순서대로 있지 않음
       3. 저장은 빠르지만, 찾는데 시간이 오래 걸림
    3. Set Associative
       - 위 두개의 중간, 현재 상용 캐시가 채택하는 방식
       - DM에 비해 검색은 느리지만 저장이 빠르고, FA에 비해 저장은 느리지만 검색이 빠름
       - 특정 로우를 지정해서 그 로운 안에 어떤 열이든 비어있으면 쭉 저장?